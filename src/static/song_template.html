<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ title }}</title>
    <link href="styles.css" rel="stylesheet" />
  </head>
  <body>
    <div class="song">
      <div id="meta">
        <h1>{{ title }}</h1>
        <p>Capo: {{ capo }}</p>
      </div>

      <div id="content">
        {% set in_chorus = false %} {% set in_verse = false %} {% set
        verse_count = namespace(value=0) %} {% for line in content %} {% if
        line.startswith('{') %} {% set directive = line[1:-1] %} {% if directive
        == 'start_of_chorus' %} {% set in_chorus = true %}
        <div class="chorus">
          <h2>Chorus</h2>
          {% elif directive == 'end_of_chorus' %} {% set in_chorus = false %}
        </div>
        {% elif directive == 'start_of_verse' %} {% set in_verse = true %} {%
        set verse_count.value = verse_count.value + 1 %}
        <div class="verse">
          <h2>Verse {{ verse_count.value }}</h2>
          {% elif directive == 'end_of_verse' %} {% set in_chorus = false %}
        </div>
        {% endif %} {% else %}
        <div class="{{ 'chorus-line' if in_chorus else 'verse-line' }}">
          {% set parts = line.split('[') %} {% for part in parts %} {% if ']' in
          part %} {% set chord_lyric = part.split(']') %}
          <span
            class="chord{{ ' chorus' if in_chorus }}"
            style="vertical-align: super"
          >
            {{ chord_lyric[0] }}
          </span>
          {{ chord_lyric[1] }} {% else %} {{ part }} {% endif %} {% endfor %}
        </div>
        {% endif %} {% endfor %}
      </div>
    </div>
  </body>
</html>
